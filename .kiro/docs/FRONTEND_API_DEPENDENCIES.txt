KAYTOP FRONTEND-TO-BACKEND API DEPENDENCIES
============================================

=== DASHBOARD KPI ENDPOINTS ===

Endpoint: GET /dashboard/kpi
HTTP Method: GET
Query Parameters: timeFilter, startDate, endDate, branch
Authentication: Required (Bearer token)
Used By:
  - app/dashboard/am/page.tsx (Account Manager Dashboard)
  - app/dashboard/system-admin/page.tsx (System Admin Dashboard)
  - app/dashboard/system-admin/customers/page.tsx (Customers page statistics)
  - app/dashboard/system-admin/credit-officers/page.tsx (Credit Officers page statistics)
Data Returned:
  - branches: { value, change, changeLabel, isCurrency }
  - creditOfficers: { value, change, changeLabel, isCurrency }
  - customers: { value, change, changeLabel, isCurrency }
  - loansProcessed: { value, change, changeLabel, isCurrency }
  - loanAmounts: { value, change, changeLabel, isCurrency }
  - activeLoans: { value, change, changeLabel, isCurrency }
  - missedPayments: { value, change, changeLabel, isCurrency }
  - bestPerformingBranches: Array of { name, activeLoans, amount }
  - worstPerformingBranches: Array of { name, activeLoans, amount }
Service: lib/services/dashboard.ts (dashboardService.getKPIs)
Service: lib/services/unifiedDashboard.ts (unifiedDashboardService.getKPIs)

=== USER MANAGEMENT ENDPOINTS ===

Endpoint: GET /admin/users
HTTP Method: GET
Query Parameters: page, limit, branch, state, role
Authentication: Required
Used By:
  - app/dashboard/system-admin/customers/page.tsx (Fetch customers)
  - app/dashboard/system-admin/credit-officers/page.tsx (Fetch credit officers)
  - lib/services/bulkLoans.ts (Aggregate customer loans)
Data Returned: Paginated array of User objects
Service: lib/services/users.ts (userService.getAllUsers)
Service: lib/services/unifiedUser.ts (unifiedUserService.getUsers)

Endpoint: GET /admin/users/{id}
HTTP Method: GET
Authentication: Required
Used By:
  - app/dashboard/am/customers/[id]/loans/page.tsx (Get customer details)
Data Returned: Single User object
Service: lib/services/users.ts (userService.getUserById)
Service: lib/services/unifiedUser.ts (unifiedUserService.getUserById)

Endpoint: GET /admin/user/{email}
HTTP Method: GET
Authentication: Required
Used By: Profile lookup operations
Data Returned: Single User object
Service: lib/services/users.ts (userService.getUserByEmail)

Endpoint: PATCH /admin/users/{id}
HTTP Method: PATCH
Authentication: Required
Used By:
  - app/dashboard/system-admin/customers/page.tsx (Edit customer)
  - app/dashboard/system-admin/credit-officers/page.tsx (Edit credit officer)
Data Expected: { firstName, lastName, email, mobileNumber, branch, state }
Data Returned: Updated User object
Service: lib/services/users.ts (userService.updateUser)
Service: lib/services/unifiedUser.ts (unifiedUserService.updateUser)

Endpoint: DELETE /admin/users/{id}
HTTP Method: DELETE
Authentication: Required
Used By:
  - app/dashboard/system-admin/credit-officers/page.tsx (Delete credit officer)
Data Returned: Success/failure response
Service: lib/services/users.ts (userService.deleteUser)
Service: lib/services/unifiedUser.ts (unifiedUserService.deleteUser)

Endpoint: PATCH /admin/users/{id}/update-role
HTTP Method: PATCH
Authentication: Required
Used By: Role management operations
Data Expected: { role }
Data Returned: Updated User object
Service: lib/services/users.ts (userService.updateUserRole)

Endpoint: GET /users/filter
HTTP Method: GET
Query Parameters: role, branch, state, page, limit
Authentication: Required
Used By: User filtering operations
Data Returned: Paginated array of User objects
Service: lib/services/unifiedUser.ts (unifiedUserService.searchUsers)

Endpoint: GET /users/profile
HTTP Method: GET
Authentication: Required
Used By: Profile management operations
Data Returned: Current user profile
Service: lib/services/profile.ts (profileService.getProfile)

Endpoint: PATCH /users/me
HTTP Method: PATCH
Authentication: Required
Used By: Profile update operations
Data Expected: { firstName, lastName, email, mobileNumber, branch, state }
Data Returned: Updated user profile
Service: lib/services/profile.ts (profileService.updateProfile)

Endpoint: PATCH /users/me/profile-picture
HTTP Method: PATCH
Authentication: Required
Content-Type: multipart/form-data
Used By: Profile picture upload
Data Expected: FormData with profilePicture file
Data Returned: Updated user profile with new picture URL
Service: lib/services/profile.ts (profileService.uploadProfilePicture)

Endpoint: GET /users/my-branch
HTTP Method: GET
Query Parameters: page, limit
Authentication: Required
Used By: Fetch users in current user's branch
Data Returned: Paginated array of User objects
Service: app/services/customerService.ts (CustomerService.getCustomersByBranch)

Endpoint: GET /users/branches
HTTP Method: GET
Authentication: Required
Used By: Get list of available branches
Data Returned: Array of branch names
Service: lib/services/branches.ts (branchService.getAllBranches - fallback)

Endpoint: GET /users/states
HTTP Method: GET
Authentication: Required
Used By: Get list of available states
Data Returned: Array of state names

=== STAFF MANAGEMENT ENDPOINTS ===

Endpoint: POST /admin/staff/create
HTTP Method: POST
Authentication: Required
Used By: Create new staff member
Data Expected: { firstName, lastName, email, mobileNumber, role, branch, state }
Data Returned: Created User object
Service: lib/services/users.ts (userService.createStaffUser)

Endpoint: GET /admin/staff/my-staff
HTTP Method: GET
Authentication: Required
Used By: Get staff managed by current user
Data Returned: Array of User objects
Service: lib/services/users.ts (userService.getMyStaff)

=== LOAN MANAGEMENT ENDPOINTS ===

Endpoint: GET /loans/all
HTTP Method: GET
Query Parameters: page, limit, status, branch, customerId
Authentication: Required
Used By: Fetch all loans
Data Returned: Paginated array of Loan objects
Service: lib/services/unifiedLoan.ts (unifiedLoanService.getLoans)

Endpoint: GET /loans/{id}
HTTP Method: GET
Authentication: Required
Used By: Get specific loan details
Data Returned: Single Loan object
Service: lib/services/unifiedLoan.ts (unifiedLoanService.getLoanById)

Endpoint: GET /loans/customer/{customerId}
HTTP Method: GET
Authentication: Required
Used By:
  - app/dashboard/am/customers/[id]/loans/page.tsx (Get customer's loans)
  - app/services/customerService.ts (getBranchCustomerLoan)
Data Returned: Array of Loan objects or paginated response
Service: lib/services/loans.ts (loanService.getCustomerLoans)
Service: lib/services/unifiedLoan.ts (unifiedLoanService.getCustomerLoans)

Endpoint: GET /loans/disbursed
HTTP Method: GET
Query Parameters: page, limit, branch
Authentication: Required
Used By:
  - app/dashboard/am/page.tsx (Disbursements tab)
  - app/dashboard/system-admin/page.tsx (Disbursements tab)
  - app/services/dashboardService.ts (getLoanDisbursed)
Data Returned: Paginated array of Loan objects
Service: lib/services/unifiedLoan.ts (unifiedLoanService.getDisbursedLoans)

Endpoint: GET /loans/recollections
HTTP Method: GET
Query Parameters: page, limit, branch
Authentication: Required
Used By:
  - app/dashboard/am/page.tsx (Re-collections tab)
  - app/dashboard/system-admin/page.tsx (Re-collections tab)
  - app/services/dashboardService.ts (getLoanRecollection)
Data Returned: Paginated array of Loan objects
Service: lib/services/unifiedLoan.ts (unifiedLoanService.getRecollections)

Endpoint: GET /loans/missed
HTTP Method: GET
Query Parameters: page, limit, branch
Authentication: Required
Used By:
  - app/dashboard/am/page.tsx (Missed payments tab)
  - app/dashboard/system-admin/page.tsx (Missed payments tab)
  - app/services/dashboardService.ts (getMissedPayment)
Data Returned: Paginated array of Loan objects
Service: lib/services/unifiedLoan.ts (unifiedLoanService.getMissedPayments)

Endpoint: GET /loans/disbursed/volume
HTTP Method: GET
Authentication: Required
Used By: Get disbursement volume data for charts
Data Returned: Array of volume data
Service: app/services/dashboardService.ts (getDisbursedVolume)

Endpoint: POST /loans/customer/{customerId}
HTTP Method: POST
Authentication: Required
Used By: Create new loan for customer
Data Expected: { amount, interestRate, repaymentPeriod, ... }
Data Returned: Created Loan object
Service: lib/services/loans.ts (loanService.createLoan)
Service: lib/services/unifiedLoan.ts (unifiedLoanService.createLoan)

Endpoint: POST /loans/{loanId}/disburse
HTTP Method: POST
Content-Type: multipart/form-data
Authentication: Required
Used By: Disburse a loan
Data Expected: FormData with proof file
Data Returned: Updated Loan object
Service: lib/services/loans.ts (loanService.disburseLoan)
Service: lib/services/unifiedLoan.ts (unifiedLoanService.disburseLoan)

Endpoint: GET /loans/{loanId}/repayments
HTTP Method: GET
Authentication: Required
Used By: Get loan repayment history
Data Returned: Array of repayment records
Service: lib/services/loans.ts (loanService.getLoanRepayments)
Service: lib/services/unifiedLoan.ts (unifiedLoanService.getLoanRepayments)

Endpoint: POST /loans/{loanId}/repayments
HTTP Method: POST
Content-Type: multipart/form-data
Authentication: Required
Used By: Record loan repayment
Data Expected: FormData with amount, paymentDate, proof file
Data Returned: Repayment record
Service: lib/services/loans.ts (loanService.recordRepayment)

Endpoint: GET /loans/customer/{customerId}/loan-summary
HTTP Method: GET
Authentication: Required
Used By: Get customer's loan summary
Data Returned: Loan summary object
Service: lib/services/loans.ts (loanService.getLoanSummary)
Service: lib/services/unifiedLoan.ts (unifiedLoanService.getLoanSummary)

Endpoint: GET /loans/customer/{customerId}/disbursement-summary
HTTP Method: GET
Authentication: Required
Used By: Get customer's disbursement summary
Data Returned: Disbursement summary object
Service: lib/services/loans.ts (loanService.getDisbursementSummary)
Service: lib/services/unifiedLoan.ts (unifiedLoanService.getDisbursementSummary)

Endpoint: POST /loans/{id}/approve
HTTP Method: POST
Authentication: Required
Used By: Approve a loan
Data Expected: { notes, conditions }
Data Returned: Updated Loan object
Service: lib/services/unifiedLoan.ts (unifiedLoanService.approveLoan)

Endpoint: POST /loans/{id}/decline
HTTP Method: POST
Authentication: Required
Used By: Decline a loan
Data Expected: { reason, notes }
Data Returned: Updated Loan object
Service: lib/services/unifiedLoan.ts (unifiedLoanService.declineLoan)

Endpoint: PUT /loans/{id}/stage
HTTP Method: PUT
Authentication: Required
Used By: Update loan stage
Data Expected: { stage, notes }
Data Returned: Updated Loan object
Service: lib/services/unifiedLoan.ts (unifiedLoanService.updateLoanStage)

=== SAVINGS MANAGEMENT ENDPOINTS ===

Endpoint: GET /savings/all
HTTP Method: GET
Query Parameters: page, limit, branch, status, customerId, search
Authentication: Required
Used By:
  - app/dashboard/am/page.tsx (Savings tab)
  - app/dashboard/system-admin/page.tsx (Savings tab)
  - app/services/dashboardService.ts (getSavings)
Data Returned: Paginated array of SavingsAccount objects
Service: lib/services/unifiedSavings.ts (unifiedSavingsService.getSavingsAccounts)

Endpoint: GET /savings/customer/{customerId}
HTTP Method: GET
Authentication: Required
Used By:
  - app/dashboard/am/customers/[id]/loans/page.tsx (Get customer savings)
  - app/services/customerService.ts (getBranchCustomerSavings)
Data Returned: SavingsAccount object
Service: lib/services/savings.ts (savingsService.getCustomerSavings)
Service: lib/services/unifiedSavings.ts (unifiedSavingsService.getCustomerSavings)

Endpoint: GET /savings/transactions/all
HTTP Method: GET
Query Parameters: page, limit, accountId, type, status, search, startDate, endDate
Authentication: Required
Used By: Get all savings transactions
Data Returned: Paginated array of Transaction objects
Service: lib/services/unifiedSavings.ts (unifiedSavingsService.getSavingsTransactions)

Endpoint: POST /savings/customer/{customerId}/deposit
HTTP Method: POST
Authentication: Required
Used By: Record savings deposit
Data Expected: { amount, description }
Data Returned: Transaction object
Service: lib/services/savings.ts (savingsService.recordDeposit)
Service: lib/services/unifiedSavings.ts (unifiedSavingsService.depositToCustomer)

Endpoint: POST /savings/customer/{customerId}/withdraw
HTTP Method: POST
Authentication: Required
Used By: Record savings withdrawal
Data Expected: { amount, description }
Data Returned: Transaction object
Service: lib/services/savings.ts (savingsService.recordWithdrawal)
Service: lib/services/unifiedSavings.ts (unifiedSavingsService.withdrawFromCustomer)

Endpoint: POST /savings/customer/{customerId}/loan-coverage
HTTP Method: POST
Authentication: Required
Used By: Use savings for loan coverage
Data Expected: { amount, loanId }
Data Returned: Transaction object
Service: lib/services/savings.ts (savingsService.useSavingsForLoanCoverage)
Service: lib/services/unifiedSavings.ts (unifiedSavingsService.approveLoanCoverage)

Endpoint: POST /savings/transactions/{transactionId}/approve-withdraw
HTTP Method: POST
Authentication: Required
Used By: Approve withdrawal transaction
Data Returned: Updated Transaction object
Service: lib/services/savings.ts (savingsService.approveTransaction)
Service: lib/services/unifiedSavings.ts (unifiedSavingsService.approveWithdrawal)

Endpoint: POST /savings/transactions/{transactionId}/approve-loan-coverage
HTTP Method: POST
Authentication: Required
Used By: Approve loan coverage transaction
Data Returned: Updated Transaction object
Service: lib/services/unifiedSavings.ts (unifiedSavingsService.approveLoanCoverage)

=== AUTHENTICATION ENDPOINTS ===

Endpoint: POST /auth/login
HTTP Method: POST
Authentication: Not required
Used By: app/services/authService.ts (AuthService.login)
Data Expected: { email, password }
Data Returned: { token, user, ... }

Endpoint: POST /auth/forgot-password
HTTP Method: POST
Authentication: Not required
Used By: app/services/authService.ts (AuthService.forgotPassword)
Data Expected: { email }
Data Returned: { message, ... }

Endpoint: POST /otp/send
HTTP Method: POST
Authentication: Not required
Used By: app/services/authService.ts (AuthService.sendOtp)
Data Expected: { email }
Data Returned: { message, ... }

Endpoint: POST /otp/verify
HTTP Method: POST
Authentication: Not required
Used By: app/services/authService.ts (AuthService.verifyOtp)
Data Expected: { email, otp }
Data Returned: { token, user, ... }

Endpoint: POST /auth/reset-password
HTTP Method: POST
Authentication: Not required
Used By: app/services/authService.ts (AuthService.resetPassword)
Data Expected: { email, otp, newPassword }
Data Returned: { message, ... }

Endpoint: POST /auth/change-password
HTTP Method: POST
Authentication: Required
Used By: lib/services/profile.ts (profileService.changePassword)
Data Expected: { currentPassword, newPassword }
Data Returned: { message, ... }

=== REPORTS ENDPOINTS ===

Endpoint: GET /reports
HTTP Method: GET
Query Parameters: page, limit, creditOfficerId, branchId, status, reportType, dateFrom, dateTo
Authentication: Required
Used By: Report listing operations
Data Returned: Paginated array of Report objects
Service: lib/services/reports.ts (reportsService.getAllReports)

Endpoint: GET /reports/{id}
HTTP Method: GET
Authentication: Required
Used By: Get specific report details
Data Returned: Single Report object
Service: lib/services/reports.ts (reportsService.getReportById)

Endpoint: POST /reports/{id}/approve
HTTP Method: POST
Authentication: Required
Used By: Approve a report
Data Expected: { notes }
Data Returned: Updated Report object
Service: lib/services/reports.ts (reportsService.approveReport)

Endpoint: POST /reports/{id}/decline
HTTP Method: POST
Authentication: Required
Used By: Decline a report
Data Expected: { reason, notes }
Data Returned: Updated Report object
Service: lib/services/reports.ts (reportsService.declineReport)

Endpoint: GET /reports/statistics
HTTP Method: GET
Query Parameters: dateFrom, dateTo, branchId
Authentication: Required
Used By: Get report statistics
Data Returned: ReportStatistics object
Service: lib/services/reports.ts (reportsService.getReportStatistics)

=== ACTIVITY LOGS ENDPOINTS ===

Endpoint: GET /admin/activity-logs
HTTP Method: GET
Query Parameters: page, limit, userId, userRole, actionType, entityType, dateFrom, dateTo, search
Authentication: Required
Used By: Activity logs listing
Data Returned: Paginated array of ActivityLog objects
Service: lib/services/activityLogs.ts (activityLogsService.getActivityLogs)

Endpoint: GET /admin/activity-logs/user/{userId}
HTTP Method: GET
Query Parameters: page, limit, userRole, actionType, entityType, dateFrom, dateTo, search
Authentication: Required
Used By: Get specific user's activity logs
Data Returned: Paginated array of ActivityLog objects
Service: lib/services/activityLogs.ts (activityLogsService.getUserActivityLogs)

=== SYSTEM SETTINGS ENDPOINTS ===

Endpoint: GET /admin/system-settings
HTTP Method: GET
Authentication: Required
Used By: Get system configuration
Data Returned: SystemSettings object
Service: lib/services/systemSettings.ts (systemSettingsService.getSystemSettings)

Endpoint: PUT /admin/system-settings
HTTP Method: PUT
Authentication: Required
Used By: Update system configuration
Data Expected: Partial SystemSettings object
Data Returned: Updated SystemSettings object
Service: lib/services/systemSettings.ts (systemSettingsService.updateSystemSettings)

=== EXPORT ENDPOINTS ===

Endpoint: GET /admin/users/export
HTTP Method: GET
Query Parameters: format (csv, excel, pdf), + filter parameters
Authentication: Required
Used By: Export users data
Data Returned: File blob
Service: lib/services/export.ts (exportService.exportUsers)

Endpoint: GET /admin/exports/history
HTTP Method: GET
Authentication: Required
Used By: Get export history
Data Returned: Array of ExportHistoryItem objects
Service: lib/services/export.ts (exportService.getExportHistory)

=== BRANCH MANAGEMENT ENDPOINTS ===

Endpoint: GET /admin/branches
HTTP Method: GET
Query Parameters: page, limit
Authentication: Required
Used By: Get all branches
Data Returned: Paginated array of Branch objects
Service: lib/services/branches.ts (branchService.getAllBranches)

Endpoint: GET /admin/branches/{id}
HTTP Method: GET
Authentication: Required
Used By: Get branch details
Data Returned: BranchDetails object with statistics
Service: lib/services/branches.ts (branchService.getBranchById)

Endpoint: POST /admin/branches
HTTP Method: POST
Authentication: Required
Used By: Create new branch
Data Expected: { name, code, address, state, region, managerId, phone, email }
Data Returned: Created Branch object
Service: lib/services/branches.ts (branchService.createBranch)

Endpoint: PATCH /admin/branches/{id}
HTTP Method: PATCH
Authentication: Required
Used By: Update branch
Data Expected: Partial branch data
Data Returned: Updated Branch object
Service: lib/services/branches.ts (branchService.updateBranch)

Endpoint: DELETE /admin/branches/{id}
HTTP Method: DELETE
Authentication: Required
Used By: Delete branch
Data Returned: Success/failure response
Service: lib/services/branches.ts (branchService.deleteBranch)

Endpoint: GET /admin/branches/{id}/statistics
HTTP Method: GET
Authentication: Required
Used By: Get branch statistics
Data Returned: BranchStatistics object
Service: lib/services/branches.ts (branchService.getBranchStatistics)

Endpoint: GET /admin/branches/state/{state}
HTTP Method: GET
Query Parameters: page, limit
Authentication: Required
Used By: Get branches by state
Data Returned: Paginated array of Branch objects
Service: lib/services/branches.ts (branchService.getBranchesByState)

Endpoint: GET /admin/branches/region/{region}
HTTP Method: GET
Query Parameters: page, limit
Authentication: Required
Used By: Get branches by region
Data Returned: Paginated array of Branch objects
Service: lib/services/branches.ts (branchService.getBranchesByRegion)

=== CUSTOMER ENDPOINTS ===

Endpoint: GET /customer/loans/my-loans
HTTP Method: GET
Authentication: Required
Used By: Customer viewing their own loans
Data Returned: Array of Loan objects
Service: lib/services/unifiedLoan.ts

Endpoint: GET /customer/loans/active-loan
HTTP Method: GET
Authentication: Required
Used By: Customer viewing their active loan
Data Returned: Single Loan object
Service: lib/services/unifiedLoan.ts

Endpoint: GET /customer/savings/my-balance
HTTP Method: GET
Authentication: Required
Used By: Customer viewing their savings balance
Data Returned: SavingsAccount object
Service: lib/services/unifiedSavings.ts

Endpoint: GET /customer/savings/my-transactions
HTTP Method: GET
Authentication: Required
Used By: Customer viewing their savings transactions
Data Returned: Array of Transaction objects
Service: lib/services/unifiedSavings.ts
